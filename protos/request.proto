syntax = "proto3";

package request;

enum MessageType {
  RAW_BYTES = 0;
  PING_REQUEST = 1;
  PING_RESULT = 2;
  COMPUTE_REQUEST = 3;
  COMPUTE_RESULT = 4;
  HOST_REQUEST = 5;
  HOST_RESULT = 6;
  REGISTER_REQUEST = 7;
  REGISTER_RESULT = 8;
  NOTIFY_START = 9;
  NOTIFY_END = 10;
  HOST_HEARTBEAT = 11;
}

message Import {
  string name = 1;
  string hash = 2;
}

message PkgConfig {
  string binary_path = 1;
  repeated string args = 2;
  repeated string envs = 3;
}

message ComputeRequest {
  bytes package = 1;
  PkgConfig config = 2;
  bool stdout = 3;
  bool stderr = 4;
  repeated string files = 5;
  repeated Import imports = 6;
  string client_id = 7;
  bool storage = 8;
}

message ComputeResult {
  bytes stdout = 1;
  bytes stderr = 2;
  map<string, bytes> files = 3;
}

message PingRequest {
}

message PingResult {
}

message HostRequest {
  bool blocking = 1;
  string client_token = 2;
}

message HostResult {
  string ip = 1;
  uint32 port = 2;
  bool found = 3;
}

message RegisterRequest {
  string id = 1;
  bytes app = 2;
}

message RegisterResult {
  string client_token = 1;
}

message NotifyStart {
  string service_name = 1;
  string description = 2;
}

message NotifyEnd {
  string service_name = 1;
  string request_token = 2;
}

message HostHeartbeat {
  string service_name = 1;
  string request_token = 2;
}
